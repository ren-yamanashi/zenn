---
title: "CDK Construct ã®ä¾å­˜é–¢ä¿‚ã‚’é©åˆ‡ã«ç®¡ç†ã™ã‚‹ ESLint ãƒ«ãƒ¼ãƒ«"
published: true
cssclass: zenn
emoji: "ğŸ“"
type: "tech"
topics: ["AWS", "TypeScript", "ESLint", "AWS CDK"]
url: "https://zenn.dev/yamaren/articles/20819f203fe5f3"
---

## æ¦‚è¦

Web ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’ã—ã¦ã„ã‚‹[å±±æ¢¨](https://twitter.com/yama_ren_tw)ã¨ã„ã„ã¾ã™ã€‚

ç§ã¯æ™®æ®µ TypeScript ã‚’ä½¿ç”¨ã—ã¦ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’é–‹ç™ºã—ã¦ãŠã‚Šã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã« **ãƒãƒ¬ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³** ã¨ **privateãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª** ã‚’ã‚ˆãåˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®å†…å®¹ã‚’ CDK ã§ã®é–‹ç™ºã«åˆã‚ã›ã¦ã€ãã‚Œãã‚Œã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†æ–¹æ³•ã¨ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã‚’é©åˆ‡ã«è¡Œã†ãŸã‚ã® ESLint ãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

:::message
ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ ESLint ãƒ«ãƒ¼ãƒ«ã¯ã€flatConfig ã«å¯¾å¿œã—ãŸå†…å®¹ã‚’è¨˜è¼‰ã—ã¦ãŠã‚Šã¾ã™ã€‚  
ã¾ãŸã€ESLint ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦ `typescript-eslint` ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã¾ã™ã€‚
:::

## 1. ãƒãƒ¬ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

ãƒãƒ¬ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ã€è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’ 1 ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«é›†ç´„ã™ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚  
å‚è€ƒ: https://typescript-jp.gitbook.io/deep-dive/main-1/barrel

CDK ã§ãƒãƒ¬ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚  
å†…å®¹ã¯ã€ä»¥ä¸‹ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

https://speakerdeck.com/gotok365/aws-cdk-reusability?slide=34

**1. ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¡ŒãŒç°¡æ½”ã«ãªã‚‹**

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å€‹åˆ¥ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™

```ts: lib/my-stack.ts
// import { Server } app from './constructs/app/server'
// import { Log } from './constructs/app/log'
import * as app from './constructs/app'
```

**2. å‘¼ã³å‡ºã—å…ƒã§ã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®Constructã‹ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚‹**

ä»¥ä¸‹ã®ã‚ˆã†ã« `<ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å>.<Constructå>` ã¨ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ã€ã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® Construct ã‹ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šã€å¯èª­æ€§ãŒå‘ä¸Šã—ã¾ã™

```ts: lib/my-stack.ts
import * as app from './constructs/app'

export class MyStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    const server = app.Server(this, 'Server')
    const lob = app.Server(this, 'Log')
  }
}
```

```ts: lib/constructs/app/index.ts
export { Server } from './server'
export { Log } from './log'
```

**3. ã©ã®ConstructãŒå¤–éƒ¨ã§ä½¿ç”¨ã•ã‚Œã‚‹ã‹ã‚’æ„å›³çš„ã«åˆ¶é™ã§ãã‚‹**

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®å ´åˆã«ã€å¤–éƒ¨ã§ä½¿ç”¨ã•ã‚Œã‚‹ Construct ã ã‘ã‚’ `index.ts` ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã§ã€Construct ã®å…¬é–‹åˆ¶é™ã‚’è¡Œã†ã“ã¨ãŒå¯èƒ½ã§ã™

```bash
./lib/
â”œâ”€â”€ my-stack.ts
â””â”€â”€ constructs
    â””â”€â”€ server
        â”œâ”€â”€ index.ts
        â”œâ”€â”€ server.ts // ã“ã‚Œã ã‘å…¬é–‹ã—ãŸã„
        â””â”€â”€ log.ts
```

```ts: lib/constructs/app/index.ts
export { Server } from './server' // Serverã ã‘ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹
```

ã“ã®ã‚ˆã†ãªåˆ©ç‚¹ã‚’ç™ºæ®ã™ã‚‹ãŸã‚ã«ã€ãƒãƒ¬ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€Construct ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯å¿…ãš `index.ts` ã‹ã‚‰è¡Œã†ã‚ˆã†ã«ãƒ«ãƒ¼ãƒ«åŒ–ã™ã‚‹ã®ãŒè‰¯ã•ãã†ã§ã™ã€‚

ã—ã‹ã—ã€Lint ãƒ«ãƒ¼ãƒ«ãŒãªã„å ´åˆã€`index.ts` ä»¥å¤–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ Construct ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã‚‚ (ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šãªã©) ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãšã€ãƒ«ãƒ¼ãƒ«é•åã«æ°—ä»˜ãã«ãã„ã§ã™ã€‚  
ãã®ãŸã‚ã€ã“ã®ãƒ«ãƒ¼ãƒ«ã‚’å¼·åˆ¶ã•ã›ã‚‹ãŸã‚ã« ESLint ã®ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚  

### ESLintãƒ«ãƒ¼ãƒ«

:::: details å„ ts ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹

```ts: lib/constructs/app/log.ts
export class Log {}
```

```ts: lib/constructs/app/server.ts
import { Log } from './log'

export class Server {
   constructor(/** ...some props */) {
     new Log() // Log Constructã‚’å‘¼ã³å‡ºã—
   }
}
```

```ts: lib/constructs/app/index.ts
export { Log } from './log'
```

::::

ESLint ã®ãƒ«ãƒ¼ãƒ«ã¯ã€[no-restricted-imports](https://eslint.org/docs/latest/rules/no-restricted-imports) ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

https://typescript-eslint.io/rules/no-restricted-imports/#how-to-use

https://eslint.org/docs/latest/rules/no-restricted-imports

```js: eslint.config.mjs
import eslint from "@eslint/js";
import tsEslint from "typescript-eslint";

export default tsEslint.config(
  eslint.configs.recommended,
  ...tsEslint.configs.strict,
  ...tsEslint.configs.stylistic,
  {
    files: ["lib/**/*.ts"],
    // çœç•¥
    rules: {
      // çœç•¥
      "@typescript-eslint/no-restricted-imports": [
        "error",
        {
          patterns: [
            {
              regex: "(\\.?\\.*/)?(constructs/)?/app/(?!index$).*",
              message:
                "`constructs/app`é…ä¸‹ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€å¿…ãšindex.tsã‹ã‚‰importã—ã¦ãã ã•ã„ã€‚",
            },
          ],
        },
      ],
    },
  },
);
```

å®Ÿéš›ã« `server.ts` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è©¦ã¿ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™

![barrel pattern error import](https://storage.googleapis.com/zenn-user-upload/ecf75891c193-20241027.png)

ã‚‚ã—ã€`lib/constructs` é…ä¸‹ã®å…¨ã¦ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒãƒ¬ãƒ«ã‚’å°å…¥ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã§ãã¾ã™

```js: eslint.config.mjs
// çœç•¥
rules: {
  "@typescript-eslint/no-restricted-imports": [
    "error",
    {
      "patterns": [
        {
          "regex": "(\\.?\\.*/)?constructs/[^/]+/(?!index$).*",
        }
      ]
    }
  ]
}
```

## 2. privateãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

ã“ã®é …ç›®ã§ã¯ã€ã€Œéå…¬é–‹ã«ã—ãŸã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã‚’ **privateãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª** ã«é…ç½®ã—ã€private ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã® Construct ã¯å¤–éƒ¨ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ããªã„ã‚ˆã†ã«å¼·åˆ¶ã™ã‚‹ ESLint ãƒ«ãƒ¼ãƒ«ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ãƒãƒ¬ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ã€Œå¤–éƒ¨ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (index.ts)ã€ã¨ã€Œå¤–éƒ¨ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œãªã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (index.ts ä»¥å¤–)ã€ã‚’åŒã˜éšå±¤ã«é…ç½®ã—ã¦ã„ã¾ã—ãŸã€‚  

ä¸€æ–¹ private ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Œå¤–éƒ¨ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (private å¤–)ã€ã¨ã€Œå¤–éƒ¨ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œãªã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (private å†…)ã€ã¯åˆ¥ã®éšå±¤ã«ãªã‚‹ãŸã‚ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’è¦‹ãŸæ™‚ã«ä¾å­˜é–¢ä¿‚ãŒã‚ˆã‚Šæ˜ç¢ºã«ãªã‚‹åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

```bash
./lib/
â”œâ”€â”€ my-stack.ts
â””â”€â”€ constructs
    â””â”€â”€ server
        â”œâ”€â”€ server.ts // private/log.tsã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹
        â””â”€â”€ private
            â””â”€â”€ log.ts
```

### ESLintãƒ«ãƒ¼ãƒ«

:::: details å„ ts ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹

```ts: lib/constructs/app/private/log.ts
export class Log {}
```

```ts: lib/constructs/app/server.ts
import { Log } from './private/log'

export class Server {
   constructor(/** ...some props */) {
     new Log() // Log Constructã‚’å‘¼ã³å‡ºã—
   }
}
```

::::

ESLint ã®ãƒ«ãƒ¼ãƒ«ã¯ã€[no-restricted-imports](https://eslint.org/docs/latest/rules/no-restricted-imports) ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```js: eslint.config.mjs
import eslint from "@eslint/js";
import tsEslint from "typescript-eslint";

export default tsEslint.config(
  eslint.configs.recommended,
  ...tsEslint.configs.strict,
  ...tsEslint.configs.stylistic,
  {
    files: ["lib/**/*.ts"],
    // çœç•¥
    rules: {
      // çœç•¥
      "@typescript-eslint/no-restricted-imports": [
        "error",
        {
          patterns: [
            {
              regex: "(\\.?\\.*/)?(constructs/)?/[^/]+/private/*",
              message: "privateãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯importã§ãã¾ã›ã‚“ã€‚",
            },
          ],
        },
      ],
    },
  },
);
```

å®Ÿéš›ã« `private/log.ts` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è©¦ã¿ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™

![private directory error case](https://storage.googleapis.com/zenn-user-upload/8cddadcaccd5-20241027.png)

ã¾ãŸã€æ­£è¦è¡¨ç¾ã«ã‚ˆã‚Š `lib/constructs/app/server.ts` ã‹ã‚‰ã¯ `lib/constructs/app/private` é…ä¸‹ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™

![private directory normal case](https://storage.googleapis.com/zenn-user-upload/15b5a131bfee-20241027.png)

## ã¾ã¨ã‚

ãƒãƒ¬ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã€private ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã«ã‚ªã‚¹ã‚¹ãƒ¡ãª ESLint ãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚  

ã“ã®è¨˜äº‹ã®åŸ·ç­†æ®µéšã§ ESLint ã® v8 ãŒ EOL ã«ãªã£ã¦ã„ãŸã®ã§ã€v9 ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚ã‚‹ flatConfig ã§ã®æ›¸ãæ–¹ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚  

https://eslint.org/blog/2024/09/eslint-v8-eol-version-support/

## å‚è€ƒ

https://speakerdeck.com/gotok365/aws-cdk-reusability

https://typescript-jp.gitbook.io/deep-dive/main-1/barrel

https://eslint.org/docs/latest/rules/no-restricted-imports
